
cat ido_mysql_conf.erb
/**
 * The db_ido_mysql library implements IDO functionality
 * for MySQL.
 */

library "db_ido_mysql"

object IdoMysqlConnection "ido-mysql" {
  user = "icinga"
  password = "icinga"
  host = "<%= @ido_mysql_host %>"
  database = "icinga"
  enable_ha = <%= @ido_enbale_ha %>

cleanup = {
        contactnotifications_age = 24h
        contactnotificationmethods_age = 24h
        eventhandlers_age = 24h
        externalcommands_age = 24h
        flappinghistory_age = 24h
        hostchecks_age = 24h
        logentries_age = 24h
        notifications_age = 24h
        processevents_age = 24h
        statehistory_age = 24h
        servicechecks_age = 24h
        systemcommands_age = 24h
}
}



common.yaml

icinga2::icinga_installation::ido_mysql_host: localhost
icinga2::icinga_installation::ido_enbale_ha: true

cat respoller-ch2d-03c.sys.comcast.net.yaml
icinga2::icinga_installation::ido_mysql_host: restool-ch2d-03c.sys.comcast.net
icinga2::icinga_installation::ido_enbale_ha: false

cat respoller-cmcd-03c.sys.comcast.net.yaml
icinga2::icinga_installation::ido_enbale_ha: false
icinga2::icinga_installation::ido_mysql_host: restool-cmcd-04c.sys.comcast.net


cat icinga_installation.pp

$ido_mysql_host = hiera('icinga2::icinga_installation::ido_mysql_host')
$ido_enbale_ha = hiera('icinga2::icinga_installation::ido_enbale_ha')



resplr:


common.yaml
icinga2::icinga_installation::ido_mysql_host: localhost
icinga2::icinga_installation::ido_enbale_ha: true






icinga2::icinga_installation::file_templ:
                constant:
                         templ: /etc/icinga2/constants.conf
						 user: icinga
						 mode: "644"	
						 content: icinga2/constants_conf.erb
                idomysql:
						templ: /etc/icinga2/feature-enabled/ido-mysql.conf
						user: icinga
						mode: "644"	
						content: icinga2/ido_mysql_conf.erb
						 
			define icinga2::icinga_installation::files_templ ($templ,$user,$mode,$content) {
                file { "$templ":
                        ensure => "file",
                        owner => $user,
                        group => $user,
                        mode  => $mode,
                        content => template('$content'),
                        notify => Service[icinga2],
                        }

																		}

